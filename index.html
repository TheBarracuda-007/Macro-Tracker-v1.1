<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Macro Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    :root {
      --bg-color: #121212;
      --text-color: #f0f0f0;
      --accent-color: #ffc107;
      --over-goal-color: #ff4d4d;
      --table-bg: #1e1e1e;
      --header-bg: #282828;
      --border-color: #333;
      --input-bg: #121212;

      --chart-consumed: #ffc107;
      --chart-remaining: #333;
      --chart-fat: #ff9800;
      --chart-carbs: #2196f3;
      --chart-protein: #e91e63;
    }

    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: var(--bg-color);
      color: var(--text-color);
    }

    #app-container {
      padding: 20px;
      max-width: 900px;
      margin: auto;
    }

    h2 {
      text-align: center;
      color: var(--accent-color);
      margin-bottom: 20px;
    }

    #goal-tracker {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      margin-bottom: 25px;
      background: var(--header-bg);
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
      flex-wrap: wrap;
      gap: 10px;
    }

    #goal-tracker label, #goal-tracker span {
      font-weight: bold;
    }

    #goal-tracker #calGoal {
      max-width: 100px;
      text-align: right;
      background: var(--input-bg);
      border: 1px solid var(--border-color);
      border-radius: 5px;
      color: var(--text-color);
      padding: 5px;
    }

    #remainingCal {
      color: var(--accent-color);
    }
    .over-goal {
      color: var(--over-goal-color) !important;
    }

    #chart-dashboard {
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 30px;
    }

    .chart-box {
      background: var(--table-bg);
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
      width: 45%;
      min-width: 250px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .chart-box canvas {
      max-height: 250px;
      max-width: 100%;
      background: var(--table-bg);
      border-radius: 8px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: var(--table-bg);
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
    }

    th, td {
      border: 1px solid var(--border-color);
      padding: 10px;
      text-align: center;
    }

    th {
      background: var(--header-bg);
    }

    input:not(#calGoal) {
      width: 100%;
      max-width: 80px;
      text-align: center;
      background: var(--input-bg);
      border: 1px solid var(--border-color);
      border-radius: 5px;
      color: var(--text-color);
      padding: 5px;
    }

    button {
      padding: 10px 16px;
      margin: 5px;
      cursor: pointer;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      background: var(--header-bg);
      color: var(--text-color);
      transition: background 0.2s, transform 0.1s;
    }

    button:hover {
      background: var(--border-color);
      transform: scale(1.03);
    }

    #memory {
      margin-top: 30px;
      padding: 15px;
      background: var(--table-bg);
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
    }

    #memory h3 {
      margin-top: 0;
      color: var(--accent-color);
      text-align: center;
    }

    .memory-entry {
      background: var(--input-bg);
      padding: 10px;
      margin: 6px 0;
      border-radius: 6px;
      border: 1px solid var(--border-color);
      white-space: pre-wrap;
    }

    #macroTable tfoot td {
      font-weight: bold;
      background: var(--header-bg);
      color: var(--accent-color);
    }

    #mobileTotals {
      display: none;
      margin-top: 20px;
      background: var(--table-bg);
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
    }

    .total-row {
      display: flex;
      justify-content: space-between;
      padding: 12px 15px;
      border-bottom: 1px solid var(--border-color);
    }
    .total-row:last-child {
      border-bottom: none;
    }
    .total-label {
      font-weight: bold;
      color: var(--accent-color);
    }
    .total-value {
      font-weight: bold;
    }

    /* Mobile */
    @media (max-width: 768px) {
      #goal-tracker {
        flex-direction: column;
        align-items: stretch;
      }

      .chart-box {
        width: 100%;
      }

      table, thead, tbody, th, td, tr {
        display: block;
      }

      thead, tfoot {
        display: none;
      }

      tr {
        border: 1px solid var(--border-color);
        margin-bottom: 10px;
        border-radius: 10px;
      }

      td {
        border: none;
        border-bottom: 1px solid var(--border-color);
        position: relative;
        padding-left: 50%;
        text-align: right;
      }

      td::before {
        content: attr(data-label);
        position: absolute;
        left: 10px;
        width: 45%;
        font-weight: bold;
        color: var(--accent-color);
        text-align: left;
      }

      td input {
        width: 100%;
      }

      #mobileTotals {
        display: block;
      }
    }
  </style>
</head>
<body>
  <div id="app-container">
    <h2>ðŸŒ™ Daily Macro Tracker</h2>

    <div id="goal-tracker">
      <div>
        <label for="calGoal">Calorie Goal:</label>
        <input type="number" id="calGoal" value="2000" oninput="calculateTotals()">
      </div>
      <div>
        <span>Remaining:</span>
        <span id="remainingCal">2000</span>
      </div>
    </div>

    <div id="chart-dashboard">
      <div class="chart-box">
        <canvas id="calPieChart"></canvas>
      </div>
      <div class="chart-box">
        <canvas id="macroPieChart"></canvas>
      </div>
    </div>

    <table id="macroTable">
      <thead>
        <tr>
          <th>Calories</th>
          <th>Fat (g)</th>
          <th>Carbs (g)</th>
          <th>Protein (g)</th>
        </tr>
      </thead>
      <tbody id="tableBody">
        <tr>
          <td data-label="Calories"><input type="number" class="cal"></td>
          <td data-label="Fat (g)"><input type="number" class="fat"></td>
          <td data-label="Carbs (g)"><input type="number" class="carb"></td>
          <td data-label="Protein (g)"><input type="number" class="prot"></td>
        </tr>
      </tbody>
      <tfoot>
        <tr>
          <td id="totalCal">0</td>
          <td id="totalFat">0</td>
          <td id="totalCarb">0</td>
          <td id="totalProt">0</td>
        </tr>
      </tfoot>
    </table>

    <div id="mobileTotals">
      <div class="total-row"><span class="total-label">Calories</span><span class="total-value" id="mobileTotalCal">0</span></div>
      <div class="total-row"><span class="total-label">Fat</span><span class="total-value" id="mobileTotalFat">0 g</span></div>
      <div class="total-row"><span class="total-label">Carbs</span><span class="total-value" id="mobileTotalCarb">0 g</span></div>
      <div class="total-row"><span class="total-label">Protein</span><span class="total-value" id="mobileTotalProt">0 g</span></div>
    </div>

    <div style="text-align:center;">
      <button onclick="addRow()">âž• Add Meal</button>
      <button onclick="saveTotals()">ðŸ’¾ Save Totals</button>
    </div>

    <div id="memory">
      <h3>ðŸ“’ Saved Totals</h3>
      <div id="memoryList"></div>
    </div>
  </div>

  <script>
    let caloriesChart, macrosChart;

    function getCSSVar(name) {
      return getComputedStyle(document.documentElement).getPropertyValue(name).trim();
    }

    function initializeCharts() {
      const options = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            labels: { color: getCSSVar('--text-color') }
          },
          title: {
            display: true,
            color: getCSSVar('--text-color'),
            font: { size: 16 }
          }
        }
      };

      const calCtx = document.getElementById('calPieChart').getContext('2d');
      caloriesChart = new Chart(calCtx, {
        type: 'doughnut',
        data: {
          labels: ['Consumed', 'Remaining'],
          datasets: [{
            data: [0, 2000],
            backgroundColor: [getCSSVar('--chart-consumed'), getCSSVar('--chart-remaining')],
            borderColor: getCSSVar('--table-bg'),
            borderWidth: 2
          }]
        },
        options: { ...options, plugins: { ...options.plugins, title: { ...options.plugins.title, text: 'Calorie Progress' } } }
      });

      const macroCtx = document.getElementById('macroPieChart').getContext('2d');
      macrosChart = new Chart(macroCtx, {
        type: 'doughnut',
        data: {
          labels: ['Fat (g)', 'Carbs (g)', 'Protein (g)'],
          datasets: [{
            data: [0, 0, 0],
            backgroundColor: [getCSSVar('--chart-fat'), getCSSVar('--chart-carbs'), getCSSVar('--chart-protein')],
            borderColor: getCSSVar('--table-bg'),
            borderWidth: 2
          }]
        },
        options: { ...options, plugins: { ...options.plugins, title: { ...options.plugins.title, text: 'Macro Breakdown' } } }
      });
    }

    function addRow() {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td data-label="Calories"><input type="number" class="cal"></td>
        <td data-label="Fat (g)"><input type="number" class="fat"></td>
        <td data-label="Carbs (g)"><input type="number" class="carb"></td>
        <td data-label="Protein (g)"><input type="number" class="prot"></td>`;
      document.getElementById("tableBody").appendChild(row);
      attachListeners(row.querySelectorAll("input"));
    }

    function calculateTotals() {
      let cal = 0, fat = 0, carb = 0, prot = 0;
      document.querySelectorAll(".cal").forEach(i => cal += Number(i.value) || 0);
      document.querySelectorAll(".fat").forEach(i => fat += Number(i.value) || 0);
      document.querySelectorAll(".carb").forEach(i => carb += Number(i.value) || 0);
      document.querySelectorAll(".prot").forEach(i => prot += Number(i.value) || 0);

      const goal = Number(document.getElementById("calGoal").value) || 0;
      const remaining = goal - cal;
      const remainingEl = document.getElementById("remainingCal");
      remainingEl.classList.remove("over-goal");
      if (remaining < 0) {
        remainingEl.textContent = Math.abs(remaining) + " over";
        remainingEl.classList.add("over-goal");
      } else {
        remainingEl.textContent = remaining;
      }

      document.getElementById("totalCal").textContent = cal;
      document.getElementById("totalFat").textContent = fat;
      document.getElementById("totalCarb").textContent = carb;
      document.getElementById("totalProt").textContent = prot;

      document.getElementById("mobileTotalCal").textContent = cal;
      document.getElementById("mobileTotalFat").textContent = fat + " g";
      document.getElementById("mobileTotalCarb").textContent = carb + " g";
      document.getElementById("mobileTotalProt").textContent = prot + " g";

      caloriesChart.data.datasets[0].data = [cal, Math.max(0, goal - cal)];
      caloriesChart.data.datasets[0].backgroundColor[0] = cal > goal ? getCSSVar('--over-goal-color') : getCSSVar('--chart-consumed');
      caloriesChart.update();

      if (fat + carb + prot === 0) {
        macrosChart.data.labels = ['No Data'];
        macrosChart.data.datasets[0].data = [1];
        macrosChart.data.datasets[0].backgroundColor = [getCSSVar('--chart-remaining')];
      } else {
        macrosChart.data.labels = ['Fat (g)', 'Carbs (g)', 'Protein (g)'];
        macrosChart.data.datasets[0].data = [fat, carb, prot];
        macrosChart.data.datasets[0].backgroundColor = [getCSSVar('--chart-fat'), getCSSVar('--chart-carbs'), getCSSVar('--chart-protein')];
      }
      macrosChart.update();
    }

    function attachListeners(inputs) {
      inputs.forEach(i => i.addEventListener("input", calculateTotals));
      calculateTotals();
    }

    function saveTotals() {
      const cal = document.getElementById("totalCal").textContent;
      const fat = document.getElementById("totalFat").textContent;
      const carb = document.getElementById("totalCarb").textContent;
      const prot = document.getElementById("totalProt").textContent;
      if (+cal + +fat + +carb + +prot === 0) {
        alert("Nothing to save!");
        return;
      }
      const now = new Date();
      const entry = document.createElement("div");
      entry.classList.add("memory-entry");
      entry.innerHTML = `<strong>${now.toLocaleDateString()} @ ${now.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}</strong><br>
      Calories: ${cal}, Fat: ${fat}g, Carbs: ${carb}g, Protein: ${prot}g`;
      document.getElementById("memoryList").prepend(entry);
    }

    window.onload = () => {
      initializeCharts();
      attachListeners(document.querySelectorAll("input"));
    };
  </script>
</body>
</html>
